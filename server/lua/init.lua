local Resources = require("selene.resources")
local Maps = require("selene.maps")
local Dimensions = require("selene.dimensions")
local Saves = require("selene.saves")

local TilesToIlla = {
    invisible = 1,
    farmland = 4,
    water = 6,
    street1 = 7,
    dirt = 8,
    forestGround = 9,
    grass = 11,
    sand1 = 3, -- previously 24
    parquet1 = 40,
    roof1 = 41,
    wall = 42,
    roof2 = 43,
    roof3 = 56,
    carpet1 = 51,
    carpet2 = 52,
    carpet3 = 53,
    carpet4 = 48,
    carpet5 = 49,
    carpet6 = 50,
    carpet7 = 45,
    carpet8 = 46,
    carpet9 = 47,
    stones = 2, -- previously 54
    marble = 55,
    lava = 5, -- previously 105
    snow = 130,
    dungeonFloor = 15 -- previously 253
}
local IllaToTiles = {}
for k, v in pairs(TilesToIlla) do
    IllaToTiles[v] = k
end

local ItemsToIlla = {
    ["item_632"] = 632,
    ["item_634"] = 634,
    ["item_670"] = 670,
    ["item_636"] = 636,
    ["item_700"] = 700,
    ["item_260"] = 260,
    ["item_702"] = 702,
    ["item_262"] = 262,
    ["item_666"] = 666,
    ["item_928"] = 928,
    ["item_477"] = 477,
    ["item_668"] = 668,
    ["item_708"] = 708,
    ["item_471"] = 471,
    ["item_710"] = 710,
    ["item_479"] = 479,
    ["item_712"] = 712,
    ["item_493"] = 493,
    ["item_714"] = 714,
    ["item_652"] = 652,
    ["item_86"] = 86,
    ["item_654"] = 654,
    ["item_340"] = 340,
    ["item_341"] = 341,
    ["item_342"] = 342,
    ["item_721"] = 721,
    ["item_722"] = 722,
    ["item_30"] = 30,
    ["item_472"] = 472,
    ["item_662"] = 662,
    ["item_87"] = 87,
    ["item_638"] = 638,
    ["item_35"] = 35,
    ["item_918"] = 918,
    ["item_478"] = 478,
    ["item_38"] = 38,
    ["item_480"] = 480,
    ["item_922"] = 922,
    ["item_482"] = 482,
    ["item_483"] = 483,
    ["item_484"] = 484,
    ["item_485"] = 485,
    ["item_486"] = 486,
    ["item_487"] = 487,
    ["item_476"] = 476,
    ["item_658"] = 658,
    ["item_238"] = 238,
    ["item_239"] = 239,
    ["item_240"] = 240,
    ["item_241"] = 241,
    ["item_261"] = 261,
    ["item_684"] = 684,
    ["item_470"] = 470,
    ["item_497"] = 497,
    ["item_31"] = 31,
    ["item_688"] = 688,
    ["item_689"] = 689,
    ["item_690"] = 690,
    ["item_481"] = 481,
    ["item_720"] = 720,
    ["item_656"] = 656,
    ["item_31"] = 31,
    ["item_37"] = 37,
    ["item_595"] = 595,
    ["item_41"] = 41,
    ["item_816"] = 816,
    ["item_225"] = 225,
    ["item_800"] = 800,
    ["item_860"] = 860,
    ["item_2585"] = 2585,
    ["item_2753"] = 2753,
    ["item_2619"] = 2619,
    ["item_608"] = 608,
    ["item_167"] = 167,
    ["item_249"] = 249,
    ["item_2738"] = 2738,
    ["item_521"] = 521,
    ["item_2291"] = 2291,
    ["item_375"] = 375,
    ["item_2497"] = 2497,
    ["item_870"] = 870,
    ["item_848"] = 848,
    ["item_232"] = 232,
    ["item_1817"] = 1817,
    ["item_3114"] = 3114,
    ["item_542"] = 542,
    ["item_65"] = 65,
    ["item_731"] = 731,
    ["item_259"] = 259,
    ["item_849"] = 849,
    ["item_269"] = 269,
    ["item_2161"] = 2161,
    ["item_91"] = 91,
    ["item_52"] = 52,
    ["item_2696"] = 2696,
    ["item_406"] = 406,
    ["item_701"] = 701,
    ["item_2699"] = 2699,
    ["item_374"] = 374,
    ["item_3085"] = 3085,
    -- ["item_2565"] = 2565,
    ["item_2170"] = 2170,
    ["item_797"] = 797,
    ["item_1791"] = 1791,
    ["item_220"] = 220,
    ["item_763"] = 763,
    ["item_705"] = 705,
    ["item_1793"] = 1793,
    ["item_2727"] = 2727,
    ["item_839"] = 839,
    ["item_2441"] = 2441,
    ["item_195"] = 195,
    ["item_2186"] = 2186,
    ["item_29"] = 29,
    ["item_3099"] = 3099,
    ["item_3086"] = 3086,
    ["item_467"] = 467,
    ["item_7"] = 7,
    ["item_2276"] = 2276,
    ["item_160"] = 160,
    ["item_309"] = 309,
    ["item_284"] = 284,
    ["item_2561"] = 2561,
    ["item_2697"] = 2697,
    ["item_446"] = 446,
    ["item_15"] = 15,
    ["item_2924"] = 2924,
    ["item_288"] = 288,
    ["item_352"] = 352,
    ["item_218"] = 218,
    ["item_2069"] = 2069,
    ["item_2879"] = 2879,
    ["item_1089"] = 1089,
    ["item_302"] = 302,
    ["item_133"] = 133,
    ["item_697"] = 697,
    ["item_380"] = 380,
    ["item_2568"] = 2568,
    ["item_181"] = 181,
    ["item_850"] = 850,
    ["item_192"] = 192,
    ["item_500"] = 500,
    ["item_51"] = 51,
    ["item_2567"] = 2567,
    ["item_208"] = 208,
    ["item_3106"] = 3106,
    ["item_2501"] = 2501,
    ["item_1912"] = 1912,
    ["item_2541"] = 2541,
    ["item_111"] = 111,
    ["item_13"] = 13,
    ["item_908"] = 908,
    ["item_914"] = 914,
    ["item_72"] = 72,
    ["item_488"] = 488,
    ["item_2778"] = 2778,
    ["item_363"] = 363,
    ["item_2491"] = 2491,
    ["item_32"] = 32,
    ["item_2598"] = 2598,
    ["item_473"] = 473,
    ["item_435"] = 435,
    ["item_216"] = 216,
    ["item_590"] = 590,
    ["item_3054"] = 3054,
    ["item_33"] = 33,
    ["item_68"] = 68,
    ["item_27"] = 27,
    ["item_210"] = 210,
    ["item_3078"] = 3078,
    ["item_741"] = 741,
    ["item_362"] = 362,
    ["item_2627"] = 2627,
    ["item_1807"] = 1807,
    ["item_331"] = 331,
    ["item_682"] = 682,
    ["item_2776"] = 2776,
    ["item_785"] = 785,
    ["item_246"] = 246,
    ["item_494"] = 494,
    ["item_351"] = 351,
    ["item_88"] = 88,
    ["item_2360"] = 2360,
    ["item_334"] = 334,
    ["item_919"] = 919,
    ["item_869"] = 869,
    ["item_324"] = 324,
    ["item_429"] = 429,
    ["item_852"] = 852,
    ["item_2710"] = 2710,
    ["item_395"] = 395,
    ["item_384"] = 384,
    ["item_631"] = 631,
    ["item_2693"] = 2693,
    ["item_1278"] = 1278,
    ["item_734"] = 734,
    ["item_397"] = 397,
    ["item_3084"] = 3084,
    ["item_633"] = 633,
    ["item_1906"] = 1906,
    ["item_112"] = 112,
    ["item_2384"] = 2384,
    ["item_523"] = 523,
    ["item_3111"] = 3111,
    ["item_543"] = 543,
    ["item_2672"] = 2672,
    ["item_605"] = 605,
    ["item_169"] = 169,
    ["item_75"] = 75,
    ["item_54"] = 54,
    ["item_596"] = 596,
    ["item_573"] = 573,
    ["item_713"] = 713,
    ["item_515"] = 515,
    ["item_775"] = 775,
    ["item_2490"] = 2490,
    ["item_187"] = 187,
    ["item_2905"] = 2905,
    ["item_414"] = 414,
    ["item_754"] = 754,
    ["item_426"] = 426,
    ["item_34"] = 34,
    ["item_643"] = 643,
    ["item_1246"] = 1246,
    ["item_48"] = 48,
    ["item_273"] = 273,
    ["item_554"] = 554,
    ["item_2636"] = 2636,
    ["item_162"] = 162,
    ["item_2872"] = 2872,
    ["item_55"] = 55,
    ["item_661"] = 661,
    ["item_600"] = 600,
    ["item_2055"] = 2055,
    ["item_2056"] = 2056,
    ["item_291"] = 291,
    ["item_376"] = 376,
    ["item_2530"] = 2530,
    ["item_166"] = 166,
    ["item_3109"] = 3109,
    ["item_3090"] = 3090,
    ["item_694"] = 694,
    ["item_719"] = 719,
    ["item_5"] = 5,
    ["item_2923"] = 2923,
    ["item_42"] = 42,
    ["item_582"] = 582,
    ["item_535"] = 535,
    ["item_833"] = 833,
    ["item_163"] = 163,
    ["item_388"] = 388,
    ["item_329"] = 329,
    ["item_674"] = 674,
    ["item_94"] = 94,
    ["item_228"] = 228,
    ["item_2656"] = 2656,
    ["item_150"] = 150,
    ["item_2915"] = 2915,
    ["item_275"] = 275,
    ["item_1"] = 1,
    ["item_66"] = 66,
    ["item_2718"] = 2718,
    ["item_826"] = 826,
    ["item_296"] = 296,
    ["item_8"] = 8,
    ["item_2737"] = 2737,
    ["item_44"] = 44,
    ["item_314"] = 314,
    ["item_2420"] = 2420,
    ["item_578"] = 578,
    ["item_18"] = 18,
    ["item_683"] = 683,
    ["item_577"] = 577,
    ["item_2456"] = 2456,
    ["item_2544"] = 2544,
    ["item_603"] = 603,
    ["item_581"] = 581,
    ["item_540"] = 540,
    ["item_2917"] = 2917,
    ["item_2700"] = 2700,
    ["item_136"] = 136,
    ["item_411"] = 411,
    ["item_2751"] = 2751,
    ["item_2194"] = 2194,
    ["item_1783"] = 1783,
    ["item_738"] = 738,
    ["item_135"] = 135,
    ["item_2445"] = 2445,
    ["item_2563"] = 2563,
    ["item_79"] = 79,
    ["item_3102"] = 3102,
    ["item_110"] = 110,
    ["item_2444"] = 2444,
    ["item_864"] = 864,
    ["item_263"] = 263,
    ["item_159"] = 159,
    ["item_508"] = 508,
    ["item_723"] = 723,
    ["item_495"] = 495,
    ["item_409"] = 409,
    ["item_709"] = 709,
    ["item_2399"] = 2399,
    ["item_2678"] = 2678,
    ["item_2856"] = 2856,
    ["item_36"] = 36,
    ["item_1061"] = 1061,
    ["item_844"] = 844,
    ["item_915"] = 915,
    ["item_824"] = 824,
    ["item_707"] = 707,
    ["item_280"] = 280,
    ["item_16"] = 16,
    ["item_305"] = 305,
    -- ["item_2526"] = 2526,
    ["item_786"] = 786,
    ["item_215"] = 215,
    ["item_335"] = 335,
    ["item_1911"] = 1911,
    ["item_106"] = 106,
    ["item_903"] = 903,
    ["item_114"] = 114,
    ["item_2542"] = 2542,
    ["item_2742"] = 2742,
    ["item_248"] = 248,
    ["item_176"] = 176,
    ["item_128"] = 128,
    ["item_319"] = 319,
    ["item_598"] = 598,
    ["item_300"] = 300,
    ["item_244"] = 244,
    ["item_921"] = 921,
    ["item_2709"] = 2709,
    ["item_2906"] = 2906,
    ["item_489"] = 489,
    ["item_272"] = 272,
    ["item_157"] = 157,
    ["item_2850"] = 2850,
    ["item_2717"] = 2717,
    ["item_2"] = 2,
    ["item_1315"] = 1315,
    ["item_693"] = 693,
    ["item_245"] = 245,
    ["item_424"] = 424,
    ["item_354"] = 354,
    ["item_2367"] = 2367,
    ["item_164"] = 164,
    ["item_143"] = 143,
    ["item_212"] = 212,
    ["item_501"] = 501,
    ["item_2302"] = 2302,
    ["item_198"] = 198,
    ["item_214"] = 214,
    ["item_145"] = 145,
    ["item_2554"] = 2554,
    ["item_2031"] = 2031,
    ["item_548"] = 548,
    ["item_2418"] = 2418,
    ["item_537"] = 537,
    ["item_204"] = 204,
    ["item_2448"] = 2448,
    ["item_109"] = 109,
    ["item_2805"] = 2805,
    ["item_361"] = 361,
    ["item_807"] = 807,
    ["item_116"] = 116,
    ["item_774"] = 774,
    ["item_2683"] = 2683,
    ["item_604"] = 604,
    ["item_3088"] = 3088,
    ["item_1812"] = 1812,
    ["item_2369"] = 2369,
    -- ["item_2743"] = 2743,
    ["item_1003"] = 1003,
    ["item_2852"] = 2852,
    ["item_152"] = 152,
    ["item_715"] = 715,
    ["item_250"] = 250,
    ["item_301"] = 301,
    ["item_102"] = 102,
    ["item_83"] = 83,
    ["item_137"] = 137,
    ["item_46"] = 46,
    ["item_295"] = 295,
    ["item_491"] = 491,
    ["item_148"] = 148,
    ["item_458"] = 458,
    ["item_186"] = 186,
    ["item_360"] = 360,
    ["item_330"] = 330,
    ["item_814"] = 814,
    ["item_2552"] = 2552,
    ["item_2878"] = 2878,
    ["item_513"] = 513,
    ["item_144"] = 144,
    ["item_93"] = 93,
    ["item_822"] = 822,
    ["item_531"] = 531,
    ["item_197"] = 197,
    ["item_316"] = 316,
    ["item_196"] = 196,
    ["item_73"] = 73,
    ["item_257"] = 257,
    ["item_2914"] = 2914,
    ["item_906"] = 906,
    ["item_2658"] = 2658,
    ["item_2616"] = 2616,
    ["item_385"] = 385,
    ["item_307"] = 307,
    ["item_704"] = 704,
    ["item_124"] = 124,
    ["item_726"] = 726,
    ["item_791"] = 791,
    ["item_592"] = 592,
    ["item_3113"] = 3113,
    ["item_757"] = 757,
    ["item_3101"] = 3101,
    ["item_3092"] = 3092,
    ["item_431"] = 431,
    ["item_496"] = 496,
    ["item_254"] = 254,
    ["item_99"] = 99,
    ["item_443"] = 443,
    ["item_378"] = 378,
    ["item_57"] = 57,
    ["item_463"] = 463,
    ["item_445"] = 445,
    ["item_292"] = 292,
    ["item_120"] = 120,
    ["item_336"] = 336,
    ["item_2610"] = 2610,
    ["item_49"] = 49,
    ["item_790"] = 790,
    ["item_266"] = 266,
    -- ["item_2674"] = 2674,
    ["item_306"] = 306,
    ["item_2569"] = 2569,
    ["item_92"] = 92,
    ["item_2655"] = 2655,
    ["item_1808"] = 1808,
    ["item_3"] = 3,
    ["item_326"] = 326,
    ["item_224"] = 224,
    ["item_2057"] = 2057,
    ["item_838"] = 838,
    ["item_2488"] = 2488,
    ["item_2705"] = 2705,
    ["item_556"] = 556,
    ["item_1257"] = 1257,
    ["item_727"] = 727,
    ["item_107"] = 107,
    ["item_442"] = 442,
    -- ["item_2728"] = 2728,
    ["item_355"] = 355,
    ["item_297"] = 297,
    ["item_857"] = 857,
    ["item_398"] = 398,
    ["item_2052"] = 2052,
    ["item_2760"] = 2760,
    ["item_904"] = 904,
    ["item_96"] = 96,
    ["item_1879"] = 1879,
    ["item_89"] = 89,
    ["item_299"] = 299,
    ["item_732"] = 732,
    ["item_579"] = 579,
    ["item_243"] = 243,
    ["item_242"] = 242,
    ["item_902"] = 902,
    ["item_138"] = 138,
    ["item_428"] = 428,
    ["item_101"] = 101,
    ["item_277"] = 277,
    ["item_926"] = 926,
    ["item_728"] = 728,
    ["item_366"] = 366,
    ["item_158"] = 158,
    ["item_131"] = 131,
    ["item_95"] = 95,
    ["item_858"] = 858,
    ["item_1250"] = 1250,
    ["item_146"] = 146,
    ["item_2783"] = 2783,
    ["item_745"] = 745,
    ["item_142"] = 142,
    ["item_783"] = 783,
    ["item_125"] = 125,
    ["item_184"] = 184,
    ["item_810"] = 810,
    ["item_825"] = 825,
    ["item_2746"] = 2746,
    ["item_516"] = 516,
    ["item_751"] = 751,
    ["item_2604"] = 2604,
    ["item_779"] = 779,
    ["item_611"] = 611,
    ["item_755"] = 755,
    ["item_859"] = 859,
    ["item_80"] = 80,
    ["item_1914"] = 1914,
    ["item_436"] = 436,
    ["item_2363"] = 2363,
    ["item_2117"] = 2117,
    ["item_1856"] = 1856,
    ["item_2723"] = 2723,
    ["item_522"] = 522,
    ["item_679"] = 679,
    ["item_2529"] = 2529,
    ["item_1245"] = 1245,
    ["item_2757"] = 2757,
    ["item_231"] = 231,
    ["item_17"] = 17,
    ["item_303"] = 303,
    ["item_2290"] = 2290,
    ["item_402"] = 402,
    ["item_610"] = 610,
    ["item_105"] = 105,
    ["item_115"] = 115,
    ["item_539"] = 539,
    ["item_724"] = 724,
    ["item_2548"] = 2548,
    ["item_555"] = 555,
    ["item_227"] = 227,
    ["item_168"] = 168,
    ["item_2715"] = 2715,
    ["item_2535"] = 2535,
    ["item_2551"] = 2551,
    ["item_564"] = 564,
    ["item_925"] = 925,
    ["item_6"] = 6,
    ["item_532"] = 532,
    ["item_2704"] = 2704,
    ["item_24"] = 24,
    ["item_2570"] = 2570,
    ["item_544"] = 544,
    ["item_132"] = 132,
    ["item_699"] = 699,
    ["item_383"] = 383,
    ["item_672"] = 672,
    ["item_258"] = 258,
    ["item_193"] = 193,
    ["item_550"] = 550,
    ["item_2645"] = 2645,
    ["item_677"] = 677,
    ["item_2584"] = 2584,
    ["item_171"] = 171,
    ["item_1318"] = 1318,
    ["item_390"] = 390,
    ["item_1861"] = 1861,
    ["item_695"] = 695,
    ["item_3051"] = 3051,
    ["item_2500"] = 2500,
    ["item_206"] = 206,
    ["item_834"] = 834,
    ["item_2439"] = 2439,
    ["item_217"] = 217,
    ["item_3097"] = 3097,
    ["item_377"] = 377,
    ["item_357"] = 357,
    ["item_905"] = 905,
    ["item_2874"] = 2874,
    ["item_294"] = 294,
    ["item_372"] = 372,
    -- ["item_2663"] = 2663,
    ["item_2059"] = 2059,
    ["item_1360"] = 1360,
    ["item_2549"] = 2549,
    ["item_510"] = 510,
    ["item_50"] = 50,
    ["item_768"] = 768,
    ["item_687"] = 687,
    ["item_1316"] = 1316,
    ["item_1862"] = 1862,
    ["item_74"] = 74,
    ["item_930"] = 930,
    ["item_2781"] = 2781,
    ["item_1909"] = 1909,
    ["item_317"] = 317,
    ["item_229"] = 229,
    ["item_2419"] = 2419,
    ["item_39"] = 39,
    ["item_2144"] = 2144,
    ["item_19"] = 19,
    ["item_841"] = 841,
    ["item_1794"] = 1794,
    ["item_127"] = 127,
    ["item_2913"] = 2913,
    ["item_553"] = 553,
    ["item_2123"] = 2123,
    ["item_285"] = 285,
    ["item_2607"] = 2607,
    ["item_2855"] = 2855,
    ["item_2851"] = 2851,
    ["item_3077"] = 3077,
    ["item_2862"] = 2862,
    ["item_676"] = 676,
    ["item_2502"] = 2502,
    ["item_23"] = 23,
    ["item_2038"] = 2038,
    ["item_2187"] = 2187,
    ["item_2857"] = 2857,
    ["item_2459"] = 2459,
    ["item_140"] = 140,
    ["item_778"] = 778,
    ["item_815"] = 815,
    ["item_602"] = 602,
    ["item_3076"] = 3076,
    ["item_325"] = 325,
    ["item_692"] = 692,
    ["item_389"] = 389,
    ["item_2937"] = 2937,
    ["item_2749"] = 2749,
    ["item_917"] = 917,
    ["item_2608"] = 2608,
    ["item_2609"] = 2609,
    ["item_1362"] = 1362,
    ["item_61"] = 61,
    ["item_528"] = 528,
    ["item_509"] = 509,
    ["item_188"] = 188,
    ["item_274"] = 274,
    ["item_1853"] = 1853,
    ["item_219"] = 219,
    ["item_3083"] = 3083,
    ["item_104"] = 104,
    ["item_2835"] = 2835,
    ["item_2659"] = 2659,
    ["item_3110"] = 3110,
    ["item_2400"] = 2400,
    ["item_264"] = 264,
    -- ["item_3036"] = 3036,
    ["item_118"] = 118,
    ["item_455"] = 455,
    ["item_2058"] = 2058,
    ["item_3091"] = 3091,
    ["item_2571"] = 2571,
    ["item_58"] = 58,
    ["item_320"] = 320,
    ["item_876"] = 876,
    ["item_108"] = 108,
    ["item_117"] = 117,
    ["item_2701"] = 2701,
    ["item_597"] = 597,
    ["item_3094"] = 3094,
    ["item_156"] = 156,
    ["item_174"] = 174,
    ["item_804"] = 804,
    ["item_855"] = 855,
    ["item_253"] = 253,
    ["item_318"] = 318,
    ["item_417"] = 417,
    ["item_2169"] = 2169,
    ["item_2393"] = 2393,
    -- ["item_2673"] = 2673,
    ["item_286"] = 286,
    ["item_475"] = 475,
    ["item_2681"] = 2681,
    ["item_425"] = 425,
    ["item_576"] = 576,
    ["item_456"] = 456,
    ["item_872"] = 872,
    ["item_615"] = 615,
    ["item_675"] = 675,
    ["item_752"] = 752,
    ["item_337"] = 337,
    ["item_421"] = 421,
    ["item_63"] = 63,
    ["item_2679"] = 2679,
    ["item_761"] = 761,
    ["item_2854"] = 2854,
    ["item_332"] = 332,
    ["item_2602"] = 2602,
    ["item_2287"] = 2287,
    ["item_221"] = 221,
    ["item_191"] = 191,
    ["item_40"] = 40,
    ["item_367"] = 367,
    ["item_1844"] = 1844,
    ["item_434"] = 434,
    ["item_2284"] = 2284,
    ["item_2395"] = 2395,
    ["item_47"] = 47,
    ["item_437"] = 437,
    ["item_1367"] = 1367,
    ["item_587"] = 587,
    ["item_520"] = 520,
    ["item_2716"] = 2716,
    ["item_230"] = 230,
    ["item_2745"] = 2745,
    ["item_2719"] = 2719,
    ["item_547"] = 547,
    ["item_2207"] = 2207,
    ["item_1804"] = 1804,
    ["item_2664"] = 2664,
    ["item_3096"] = 3096,
    ["item_847"] = 847,
    ["item_4"] = 4,
    ["item_69"] = 69,
    ["item_2303"] = 2303,
    ["item_1797"] = 1797,
    ["item_748"] = 748,
    ["item_794"] = 794,
    ["item_386"] = 386,
    ["item_1857"] = 1857,
    ["item_2111"] = 2111,
    ["item_673"] = 673,
    ["item_327"] = 327,
    ["item_837"] = 837,
    ["item_283"] = 283,
    ["item_64"] = 64,
    ["item_2908"] = 2908,
    ["item_538"] = 538,
    ["item_2668"] = 2668,
    ["item_226"] = 226,
    ["item_2113"] = 2113,
    ["item_179"] = 179,
    ["item_199"] = 199,
    ["item_2493"] = 2493,
    ["item_293"] = 293,
    ["item_3115"] = 3115,
    ["item_901"] = 901,
    ["item_1855"] = 1855,
    ["item_803"] = 803,
    ["item_1251"] = 1251,
    ["item_313"] = 313,
    ["item_2940"] = 2940,
    ["item_213"] = 213,
    ["item_1910"] = 1910,
    ["item_2402"] = 2402,
    ["item_613"] = 613,
    ["item_718"] = 718,
    ["item_45"] = 45,
    ["item_782"] = 782,
    ["item_737"] = 737,
    ["item_3095"] = 3095,
    ["item_1272"] = 1272,
    ["item_209"] = 209,
    ["item_1060"] = 1060,
    ["item_3105"] = 3105,
    ["item_909"] = 909,
    ["item_2952"] = 2952,
    ["item_2162"] = 2162,
    ["item_2114"] = 2114,
    ["item_349"] = 349,
    ["item_382"] = 382,
    ["item_840"] = 840,
    ["item_270"] = 270,
    ["item_234"] = 234,
    ["item_28"] = 28,
    ["item_172"] = 172,
    ["item_836"] = 836,
    ["item_526"] = 526,
    ["item_835"] = 835,
    ["item_832"] = 832,
    ["item_147"] = 147,
    ["item_2140"] = 2140,
    ["item_831"] = 831,
    ["item_830"] = 830,
    ["item_829"] = 829,
    ["item_1319"] = 1319,
    ["item_773"] = 773,
    ["item_828"] = 828,
    ["item_84"] = 84,
    ["item_827"] = 827,
    ["item_575"] = 575,
    ["item_736"] = 736,
    ["item_823"] = 823,
    ["item_183"] = 183,
    ["item_290"] = 290,
    ["item_492"] = 492,
    ["item_139"] = 139,
    ["item_821"] = 821,
    ["item_323"] = 323,
    ["item_820"] = 820,
    ["item_56"] = 56,
    ["item_190"] = 190,
    ["item_76"] = 76,
    ["item_703"] = 703,
    ["item_717"] = 717,
    ["item_818"] = 818,
    ["item_766"] = 766,
    ["item_1858"] = 1858,
    ["item_813"] = 813,
    ["item_812"] = 812,
    ["item_811"] = 811,
    ["item_618"] = 618,
    ["item_2407"] = 2407,
    ["item_625"] = 625,
    ["item_729"] = 729,
    ["item_808"] = 808,
    ["item_806"] = 806,
    ["item_805"] = 805,
    ["item_802"] = 802,
    ["item_2837"] = 2837,
    ["item_2875"] = 2875,
    ["item_1842"] = 1842,
    ["item_799"] = 799,
    ["item_2525"] = 2525,
    ["item_798"] = 798,
    ["item_449"] = 449,
    ["item_795"] = 795,
    ["item_2185"] = 2185,
    ["item_2116"] = 2116,
    ["item_924"] = 924,
    ["item_793"] = 793,
    ["item_119"] = 119,
    ["item_789"] = 789,
    ["item_161"] = 161,
    ["item_787"] = 787,
    ["item_134"] = 134,
    ["item_1273"] = 1273,
    ["item_784"] = 784,
    ["item_2801"] = 2801,
    ["item_659"] = 659,
    ["item_780"] = 780,
    ["item_777"] = 777,
    ["item_308"] = 308,
    ["item_776"] = 776,
    ["item_772"] = 772,
    ["item_10"] = 10,
    ["item_1915"] = 1915,
    ["item_770"] = 770,
    ["item_868"] = 868,
    ["item_759"] = 759,
    ["item_758"] = 758,
    ["item_2832"] = 2832,
    ["item_2714"] = 2714,
    ["item_2863"] = 2863,
    ["item_856"] = 856,
    ["item_665"] = 665,
    ["item_851"] = 851,
    ["item_846"] = 846,
    ["item_3082"] = 3082,
    ["item_747"] = 747,
    ["item_750"] = 750,
    ["item_2740"] = 2740,
    ["item_698"] = 698,
    ["item_268"] = 268,
    ["item_696"] = 696,
    ["item_2389"] = 2389,
    ["item_353"] = 353,
    ["item_559"] = 559,
    ["item_387"] = 387,
    ["item_2550"] = 2550,
    ["item_2534"] = 2534,
    ["item_530"] = 530,
    ["item_512"] = 512,
    ["item_529"] = 529,
    ["item_527"] = 527,
    ["item_2188"] = 2188,
    ["item_1361"] = 1361,
    ["item_2556"] = 2556,
    ["item_222"] = 222,
    ["item_202"] = 202,
    ["item_498"] = 498,
    ["item_541"] = 541,
    ["item_2295"] = 2295,
    ["item_1782"] = 1782,
    ["item_769"] = 769,
    ["item_371"] = 371,
    ["item_200"] = 200,
    ["item_743"] = 743,
    ["item_817"] = 817,
    ["item_765"] = 765,
    ["item_764"] = 764,
    ["item_364"] = 364,
    ["item_760"] = 760,
    ["item_622"] = 622,
    ["item_609"] = 609,
    ["item_2694"] = 2694,
    ["item_2046"] = 2046,
    ["item_877"] = 877,
    ["item_871"] = 871,
    ["item_1854"] = 1854,
    ["item_344"] = 344,
    ["item_454"] = 454,
    ["item_203"] = 203,
    ["item_2141"] = 2141,
    ["item_863"] = 863,
    ["item_842"] = 842,
    ["item_466"] = 466,
    ["item_2622"] = 2622,
    ["item_465"] = 465,
    ["item_271"] = 271,
    ["item_464"] = 464,
    ["item_2421"] = 2421,
    ["item_2041"] = 2041,
    ["item_462"] = 462,
    ["item_534"] = 534,
    ["item_298"] = 298,
    ["item_460"] = 460,
    ["item_459"] = 459,
    ["item_626"] = 626,
    ["item_2039"] = 2039,
    ["item_867"] = 867,
    ["item_2079"] = 2079,
    ["item_1265"] = 1265,
    ["item_453"] = 453,
    ["item_916"] = 916,
    ["item_418"] = 418,
    ["item_451"] = 451,
    ["item_419"] = 419,
    ["item_468"] = 468,
    ["item_796"] = 796,
    ["item_310"] = 310,
    ["item_448"] = 448,
    ["item_749"] = 749,
    ["item_178"] = 178,
    ["item_447"] = 447,
    ["item_401"] = 401,
    ["item_14"] = 14,
    ["item_444"] = 444,
    ["item_1860"] = 1860,
    ["item_1813"] = 1813,
    ["item_123"] = 123,
    ["item_1809"] = 1809,
    ["item_98"] = 98,
    ["item_2606"] = 2606,
    ["item_85"] = 85,
    ["item_2784"] = 2784,
    ["item_82"] = 82,
    ["item_71"] = 71,
    ["item_67"] = 67,
    ["item_2708"] = 2708,
    ["item_593"] = 593,
    ["item_2682"] = 2682,
    ["item_441"] = 441,
    ["item_440"] = 440,
    ["item_255"] = 255,
    ["item_0"] = 0,
    ["item_2635"] = 2635,
    ["item_438"] = 438,
    ["item_433"] = 433,
    ["item_536"] = 536,
    ["item_2654"] = 2654,
    ["item_2145"] = 2145,
    ["item_2547"] = 2547,
    ["item_653"] = 653,
    ["item_60"] = 60,
    ["item_843"] = 843,
    -- ["item_2652"] = 2652,
    ["item_432"] = 432,
    ["item_742"] = 742,
    ["item_2615"] = 2615,
    ["item_740"] = 740,
    ["item_122"] = 122,
    ["item_801"] = 801,
    ["item_2744"] = 2744,
    ["item_430"] = 430,
    ["item_427"] = 427,
    ["item_423"] = 423,
    ["item_22"] = 22,
    ["item_422"] = 422,
    ["item_420"] = 420,
    ["item_452"] = 452,
    ["item_416"] = 416,
    ["item_415"] = 415,
    ["item_130"] = 130,
    ["item_322"] = 322,
    ["item_2647"] = 2647,
    ["item_2621"] = 2621,
    ["item_2579"] = 2579,
    ["item_2378"] = 2378,
    ["item_412"] = 412,
    ["item_1266"] = 1266,
    ["item_2786"] = 2786,
    ["item_410"] = 410,
    ["item_503"] = 503,
    ["item_408"] = 408,
    ["item_407"] = 407,
    ["item_2617"] = 2617,
    ["item_2577"] = 2577,
    ["item_339"] = 339,
    ["item_1005"] = 1005,
    ["item_405"] = 405,
    ["item_546"] = 546,
    ["item_792"] = 792,
    ["item_103"] = 103,
    ["item_730"] = 730,
    ["item_312"] = 312,
    ["item_403"] = 403,
    ["item_304"] = 304,
    ["item_570"] = 570,
    ["item_399"] = 399,
    ["item_2416"] = 2416,
    ["item_370"] = 370,
    ["item_396"] = 396,
    ["item_394"] = 394,
    -- ["item_2707"] = 2707,
    ["item_393"] = 393,
    ["item_315"] = 315,
    ["item_845"] = 845,
    ["item_391"] = 391,
    ["item_3055"] = 3055,
    ["item_620"] = 620,
    ["item_920"] = 920,
    ["item_517"] = 517,
    ["item_599"] = 599,
    ["item_739"] = 739,
    ["item_735"] = 735,
    ["item_457"] = 457,
    ["item_43"] = 43,
    ["item_725"] = 725,
    ["item_819"] = 819,
    ["item_716"] = 716,
    ["item_474"] = 474,
    ["item_2536"] = 2536,
    ["item_1254"] = 1254,
    ["item_201"] = 201,
    ["item_706"] = 706,
    ["item_20"] = 20,
    ["item_691"] = 691,
    ["item_571"] = 571,
    ["item_373"] = 373,
    ["item_681"] = 681,
    ["item_81"] = 81,
    ["item_680"] = 680,
    ["item_594"] = 594,
    ["item_671"] = 671,
    ["item_667"] = 667,
    ["item_669"] = 669,
    ["item_173"] = 173,
    ["item_281"] = 281,
    ["item_657"] = 657,
    ["item_655"] = 655,
    ["item_651"] = 651,
    ["item_21"] = 21,
    ["item_155"] = 155,
    ["item_3116"] = 3116,
    ["item_450"] = 450,
    ["item_356"] = 356,
    ["item_2365"] = 2365,
    ["item_350"] = 350,
    ["item_641"] = 641,
    ["item_639"] = 639,
    ["item_2559"] = 2559,
    ["item_637"] = 637,
    ["item_635"] = 635,
    ["item_1859"] = 1859,
    ["item_2876"] = 2876,
    ["item_2711"] = 2711,
    ["item_549"] = 549,
    ["item_70"] = 70,
    ["item_630"] = 630,
    ["item_2586"] = 2586,
    ["item_711"] = 711,
    ["item_628"] = 628,
    ["item_514"] = 514,
    ["item_733"] = 733,
    ["item_624"] = 624,
    ["item_2189"] = 2189,
    ["item_623"] = 623,
    ["item_175"] = 175,
    ["item_552"] = 552,
    ["item_2785"] = 2785,
    ["item_619"] = 619,
    ["item_2646"] = 2646,
    ["item_616"] = 616,
    ["item_614"] = 614,
    ["item_612"] = 612,
    ["item_923"] = 923,
    ["item_2172"] = 2172,
    ["item_2121"] = 2121,
    ["item_2183"] = 2183,
    ["item_606"] = 606,
    ["item_601"] = 601,
    ["item_346"] = 346,
    ["item_678"] = 678,
    ["item_591"] = 591,
    ["item_589"] = 589,
    ["item_3098"] = 3098,
    ["item_588"] = 588,
    ["item_2750"] = 2750,
    ["item_585"] = 585,
    ["item_237"] = 237,
    ["item_900"] = 900,
    ["item_278"] = 278,
    ["item_584"] = 584,
    ["item_2877"] = 2877,
    ["item_545"] = 545,
    ["item_574"] = 574,
    ["item_572"] = 572,
    ["item_400"] = 400,
    ["item_569"] = 569,
    ["item_568"] = 568,
    ["item_562"] = 562,
    ["item_567"] = 567,
    ["item_113"] = 113,
    ["item_561"] = 561,
    ["item_2605"] = 2605,
    ["item_565"] = 565,
    ["item_563"] = 563,
    ["item_1001"] = 1001,
    ["item_566"] = 566,
    ["item_211"] = 211,
    ["item_358"] = 358,
    ["item_560"] = 560,
    ["item_557"] = 557,
    ["item_621"] = 621,
    ["item_551"] = 551,
    ["item_558"] = 558,
    ["item_121"] = 121,
    ["item_580"] = 580,
    ["item_469"] = 469,
    ["item_2680"] = 2680,
    ["item_649"] = 649,
    ["item_2739"] = 2739,
    ["item_525"] = 525,
    ["item_287"] = 287,
    ["item_1840"] = 1840,
    ["item_2403"] = 2403,
    ["item_256"] = 256,
    ["item_2528"] = 2528,
    ["item_645"] = 645,
    ["item_2364"] = 2364,
    ["item_3035"] = 3035,
    ["item_2359"] = 2359,
    ["item_2357"] = 2357,
    ["item_149"] = 149,
    ["item_506"] = 506,
    ["item_461"] = 461,
    ["item_2907"] = 2907,
    ["item_3081"] = 3081,
    ["item_279"] = 279,
    ["item_519"] = 519,
    ["item_2925"] = 2925,
    ["item_26"] = 26,
    ["item_627"] = 627,
    ["item_189"] = 189,
    ["item_2543"] = 2543,
    ["item_2388"] = 2388,
    ["item_2572"] = 2572,
    ["item_511"] = 511,
    ["item_507"] = 507,
    ["item_2193"] = 2193,
    ["item_504"] = 504,
    ["item_2457"] = 2457,
    ["item_2286"] = 2286,
    ["item_3112"] = 3112,
    ["item_233"] = 233,
    ["item_3108"] = 3108,
    ["item_3107"] = 3107,
    ["item_53"] = 53,
    ["item_3104"] = 3104,
    ["item_2494"] = 2494,
    ["item_77"] = 77,
    ["item_185"] = 185,
    ["item_3100"] = 3100,
    ["item_381"] = 381,
    ["item_3093"] = 3093,
    ["item_1795"] = 1795,
    ["item_3087"] = 3087,
    ["item_12"] = 12,
    ["item_247"] = 247,
    ["item_392"] = 392,
    ["item_524"] = 524,
    ["item_3075"] = 3075,
    ["item_3056"] = 3056,
    ["item_141"] = 141,
    ["item_2566"] = 2566,
    ["item_2935"] = 2935,
    ["item_2934"] = 2934,
    ["item_2922"] = 2922,
    ["item_2927"] = 2927,
    ["item_2527"] = 2527,
    -- ["item_2562"] = 2562,
    ["item_180"] = 180,
    ["item_518"] = 518,
    ["item_2916"] = 2916,
    ["item_2885"] = 2885,
    ["item_2880"] = 2880,
    ["item_583"] = 583,
    ["item_2873"] = 2873,
    ["item_2853"] = 2853,
    ["item_2836"] = 2836,
    ["item_756"] = 756,
    ["item_1908"] = 1908,
    ["item_251"] = 251,
    ["item_2830"] = 2830,
    ["item_781"] = 781,
    ["item_2788"] = 2788,
    ["item_2782"] = 2782,
    ["item_2780"] = 2780,
    ["item_2662"] = 2662,
    ["item_2775"] = 2775,
    ["item_2763"] = 2763,
    ["item_368"] = 368,
    ["item_321"] = 321,
    ["item_2122"] = 2122,
    ["item_586"] = 586,
    ["item_2748"] = 2748,
    ["item_2747"] = 2747,
    ["item_2834"] = 2834,
    ["item_1841"] = 1841,
    ["item_2731"] = 2731,
    ["item_2725"] = 2725,
    ["item_753"] = 753,
    ["item_2689"] = 2689,
    ["item_2685"] = 2685,
    ["item_685"] = 685,
    ["item_11"] = 11,
    ["item_2675"] = 2675,
    ["item_2671"] = 2671,
    ["item_2777"] = 2777,
    ["item_788"] = 788,
    ["item_746"] = 746,
    -- ["item_2650"] = 2650,
    ["item_617"] = 617,
    ["item_2642"] = 2642,
    ["item_2640"] = 2640,
    ["item_439"] = 439,
    ["item_2278"] = 2278,
    ["item_2620"] = 2620,
    ["item_413"] = 413,
    ["item_2626"] = 2626,
    ["item_126"] = 126,
    ["item_2184"] = 2184,
    ["item_207"] = 207,
    ["item_2573"] = 2573,
    ["item_505"] = 505,
    ["item_379"] = 379,
    ["item_2946"] = 2946,
    -- ["item_2564"] = 2564,
    ["item_129"] = 129,
    ["item_2560"] = 2560,
    ["item_2558"] = 2558,
    ["item_2553"] = 2553,
    ["item_289"] = 289,
    ["item_744"] = 744,
    ["item_2537"] = 2537,
    ["item_533"] = 533,
    ["item_170"] = 170,
    ["item_2926"] = 2926,
    ["item_878"] = 878,
    ["item_282"] = 282,
    ["item_907"] = 907,
    ["item_2496"] = 2496,
    ["item_2495"] = 2495,
    ["item_2112"] = 2112,
    ["item_90"] = 90,
    ["item_2492"] = 2492,
    ["item_333"] = 333,
    ["item_2447"] = 2447,
    ["item_809"] = 809,
    ["item_2380"] = 2380,
    ["item_1792"] = 1792,
    ["item_1843"] = 1843,
    ["item_62"] = 62,
    ["item_502"] = 502,
    ["item_2629"] = 2629,
    ["item_2124"] = 2124,
    ["item_2752"] = 2752,
    ["item_607"] = 607,
    ["item_25"] = 25,
    ["item_2499"] = 2499,
    ["item_771"] = 771,
    ["item_9"] = 9,
    ["item_1907"] = 1907,
    ["item_767"] = 767,
    ["item_2390"] = 2390,
    ["item_3089"] = 3089,
    ["item_2377"] = 2377,
    ["item_1790"] = 1790,
    ["item_1317"] = 1317,
    ["item_1276"] = 1276,
    ["item_1247"] = 1247,
    ["item_1008"] = 1008,
    ["item_265"] = 265,
    ["item_2498"] = 2498,
    ["item_490"] = 490,
    ["item_499"] = 499,
    ["item_1880"] = 1880,
    ["item_369"] = 369,
    ["item_177"] = 177,
    ["item_762"] = 762,
    ["item_359"] = 359,
    ["item_647"] = 647,
    ["item_347"] = 347,
    ["item_338"] = 338,
    ["item_348"] = 348,
    ["item_345"] = 345,
    ["item_343"] = 343,
    ["item_328"] = 328,
    ["item_404"] = 404,
    ["item_235"] = 235,
    ["item_311"] = 311,
    ["item_663"] = 663,
    ["item_276"] = 276,
    ["item_267"] = 267,
    ["item_1796"] = 1796,
    ["item_194"] = 194,
    ["item_252"] = 252,
    ["item_236"] = 236,
    ["item_223"] = 223,
    ["item_2588"] = 2588,
    ["item_205"] = 205,
    ["item_629"] = 629,
    ["item_59"] = 59,
    ["item_365"] = 365,
    ["item_165"] = 165,
    ["item_151"] = 151,
    ["item_2660"] = 2660,
    ["item_154"] = 154,
    ["item_153"] = 153,
    ["item_97"] = 97,
    ["item_182"] = 182
}
local IllaToItems = {}
for k, v in pairs(ItemsToIlla) do
    IllaToItems[v] = k
    -- print("\"illarion:" .. k .. "\": { \"visual\": \"illarion:items/" .. k  .. "\", \"slowFactor\": 0 },")
    -- print("\"illarion:" .. k .. "\": { \"type\": \"tile\", \"texture\": \"client/textures/illarion/items/" .. k .. ".png\" },")
end

function convertMap(tilesFile)
    local basePath = tilesFile:gsub(".tiles.txt", "")
    local baseName = basePath:gsub("illarion%-gobaith%-map/server/maps/", "")
    local outputPath = "maps/partial/" .. baseName .. ".selenemap"
    -- Skip if a converted version of this map is already present
    if Saves.Has(outputPath) then
        return outputPath
    end

    local unknownTiles = {}
    local unknownItems = {}

    local map = Maps.Create()
    local tilesInput = Resources.LoadAsString(tilesFile)
    local header = {}
    local startX, startY, z
    for line in tilesInput:gmatch("([^\n]*)\n?") do
        -- Headers are in the format Key: Value
        local key, value = line:match("([^:]+):([^;]+);?")
        if key then
            header[key] = trim(value)
            if key == "X" then
                startX = tonumber(header["X"])
            elseif key == "Y" then
                startY = tonumber(header["Y"])
            elseif key == "L" then
                z = tonumber(header["L"]) - 31000
            end
        else
            -- Tiles are in the format X;Y;Tile;Music
            local x, y, combinedTileId, music = line:match("(-?%d+);(-?%d+);(%d+);(%d+)")

            local BASE_MASK = 0x001F
            local OVERLAY_MASK = 0x03E0
            local SHAPE_MASK = 0xFC00
            local tileId = tonumber(combinedTileId)
            if (tileId & SHAPE_MASK) ~= 0 then
                tileId = tileId & BASE_MASK
            end

            local tileName = IllaToTiles[tileId]
            if tileName == nil then
                unknownTiles[tileId] = unknownTiles[tileId] and unknownTiles[tileId] + 1 or 1
            else
                map:PlaceTile(startX + tonumber(x), startY + tonumber(y), z, "illarion:" .. tileName)
            end
        end
    end
    local itemsInput = Resources.LoadAsString(basePath .. ".items.txt")
    for line in itemsInput:gmatch("([^\n]*)\n?") do
        if trim(line) ~= "" then
            -- Items are in the format X;Y;Item;Quality
            local x, y, itemId, quality = line:match("(-?%d+);(-?%d+);(-?%d+);(-?%d+)")
            local itemName = IllaToItems[tonumber(itemId)]
            if itemName == nil then
                unknownItems[tonumber(itemId)] = quality
            else
                map:PlaceTile(tonumber(x) + startX, tonumber(y) + startY, z, "illarion:" .. itemName)
            end
        end
    end
    local warpsInput = Resources.LoadAsString(basePath .. ".warps.txt")
    for line in warpsInput:gmatch("([^\n]*)\n?") do
        if trim(line) ~= "" then
            -- Warps are in the format X;Y;ToX;ToY;ToLevel
            local x, y, toX, toY, toLevel = line:match("(-?%d+);(-?%d+);(-?%d+);(-?%d+);(-?%d+)")
            map:AnnotateTile(tonumber(x) + startX, tonumber(y) + startY, z, "illarion:warp", {
                ToX = tonumber(x) + startX,
                ToY = tonumber(y) + startY,
                ToLevel = tonumber(toLevel) - 31000
            })
        end
    end

    for k, v in pairs(unknownTiles) do
        print("Unknown tile id " .. k .. " in " .. baseName .. " (x " .. v .. ")")
    end
    for k, v in pairs(unknownItems) do
        print("Unknown item id " .. k .. " in " .. baseName)
    end

    print("Saving " .. outputPath)
    Saves.Save(map, outputPath)
    return outputPath
end

local mergedMapPath = "maps/illarion-gobaith.selenemap"
if not Saves.Has(mergedMapPath) then
    local mergedMap = Maps.Create()
    local files = Resources.ListFiles("illarion-gobaith-map", "server/maps/*.tiles.txt")
    for _, file in pairs(files) do
        local outputPath = convertMap(file)
        local mapTree = Saves.Load(outputPath)
        if mapTree then
            mergedMap:Merge(mapTree)
        else
            print("Failed to load " .. outputPath)
        end
    end
    Saves.Save(mergedMap, mergedMapPath)
end

print("Loading " .. mergedMapPath)
local gobaithMap = Saves.Load(mergedMapPath)
Dimensions.GetDefault():SetMap(gobaithMap)